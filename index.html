<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>TRUY·ªÜN D·ªäCH</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 15px;
      margin: 0;
      user-select: none;
      overflow-x: hidden;
    }

    h2 {
      font-size: clamp(20px, 5vw, 24px);
      margin-bottom: 15px;
    }

    ul {
      list-style-type: none;
      padding-left: 10px;
    }

    li {
      margin: 10px 0;
    }

    a.folder {
      font-size: clamp(16px, 4vw, 18px);
      color: #0066cc;
      font-weight: bold;
      cursor: pointer;
      display: block;
      text-decoration: none;
    }

    a.folder:hover {
      color: #ff6600;
    }

    .children {
      margin-left: 15px;
      font-size: clamp(14px, 3.5vw, 16px);
      display: none;
    }

    .file-link {
      text-decoration: none;
      color: green;
      display: block;
    }

    .file-link:hover {
      text-decoration: underline;
    }

    /* PDF Viewer */
    #pdfViewer {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: #fff;
      z-index: 1000;
    }

    #pdfViewer h3 {
      margin: 10px;
      font-size: clamp(16px, 4vw, 18px);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    #pdfViewer button {
      background: #ff4d4d;
      color: white;
      border: none;
      padding: 8px 15px;
      border-radius: 5px;
      cursor: pointer;
      font-size: clamp(14px, 3.5vw, 16px);
    }

    #pdfViewer button:hover {
      background: #e60000;
    }

    #pdfFrame {
      border: none;
      width: 100%;
      height: calc(100% - 50px);
    }

    /* Image Gallery */
    #imageGallery {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: #000;
      z-index: 1000;
      overflow: hidden;
    }

    #imageGallery h3 {
      margin: 10px;
      font-size: clamp(16px, 4vw, 18px);
      color: white;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    #imageGallery button {
      background: #ff4d4d;
      color: white;
      border: none;
      padding: 8px 15px;
      border-radius: 5px;
      cursor: pointer;
      font-size: clamp(14px, 3.5vw, 16px);
    }

    #imageGallery button:hover {
      background: #e60000;
    }

    .gallery-container {
      display: flex;
      overflow-x: auto;
      scroll-snap-type: x mandatory;
      height: calc(100% - 50px);
      scroll-behavior: smooth;
      -webkit-overflow-scrolling: touch;
    }

    .gallery-item {
      flex: 0 0 100%;
      scroll-snap-align: center;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .gallery-item img {
      max-width: 100%;
      max-height: 100%;
      object-fit: contain;
      display: block;
    }

    .error-message {
      color: red;
      font-size: clamp(14px, 3.5vw, 16px);
      text-align: center;
      margin-top: 20px;
    }

    /* Media Queries cho m√†n h√¨nh nh·ªè */
    @media screen and (max-width: 600px) {
      body {
        padding: 10px;
      }

      h2 {
        font-size: clamp(18px, 4.5vw, 20px);
      }

      a.folder {
        font-size: clamp(14px, 3.8vw, 16px);
      }

      .children {
        margin-left: 10px;
        font-size: clamp(12px, 3.2vw, 14px);
      }

      #pdfViewer h3, #imageGallery h3 {
        margin: 5px;
      }

      #pdfViewer button, #imageGallery button {
        padding: 6px 12px;
        font-size: clamp(12px, 3.2vw, 14px);
      }
    }
  </style>
</head>
<body>
  <h2>üìÅ Th∆∞ m·ª•c Google Drive</h2>
  <ul id="folderList">ƒêang t·∫£i...</ul>
  <div id="pdfViewer">
    <h3>Xem PDF <button onclick="document.getElementById('pdfViewer').style.display='none'">ƒê√≥ng</button></h3>
    <iframe id="pdfFrame" sandbox="allow-same-origin allow-scripts"></iframe>
  </div>
  <div id="imageGallery">
    <h3 id="galleryTitle">Xem ·∫¢nh <button onclick="document.getElementById('imageGallery').style.display='none'">ƒê√≥ng</button></h3>
    <div class="gallery-container" id="galleryContainer"></div>
  </div>

  <script>
    const API_KEY = 'AIzaSyB88SNWBpeBPRkg1KdgXc0K5rEOoih0zOM'; // API Key b·∫°n cung c·∫•p
    const ROOT_FOLDER_ID = '1mbA2FZ3cN0lPf9eFyV4Pylw54BEL6ymi'; // Folder ID b·∫°n cung c·∫•p

    // V√¥ hi·ªáu h√≥a chu·ªôt ph·∫£i v√† s·ª± ki·ªán c·∫£m ·ª©ng
    document.addEventListener('contextmenu', function(e) {
      e.preventDefault();
    });

    // V√¥ hi·ªáu h√≥a F12, Ctrl+Shift+I, Ctrl+U
    document.addEventListener('keydown', function(e) {
      if (e.key === 'F12' || 
          (e.ctrlKey && e.shiftKey && (e.key === 'I' || e.key === 'C' || e.key === 'J')) || 
          (e.ctrlKey && e.key === 'U')) {
        e.preventDefault();
      }
    });

    // V√¥ hi·ªáu h√≥a sao ch√©p v√† k√©o-th·∫£
    document.addEventListener('copy', function(e) {
      e.preventDefault();
    });
    document.addEventListener('dragstart', function(e) {
      e.preventDefault();
    });

    async function fetchFolderContents(folderId) {
      try {
        const url = `https://www.googleapis.com/drive/v3/files?q='${folderId}'+in+parents&key=${API_KEY}&fields=files(id,name,mimeType)`;
        const res = await fetch(url);
        if (!res.ok) {
          throw new Error(`L·ªói API: ${res.status} ${res.statusText}. Ki·ªÉm tra API Key ho·∫∑c quy·ªÅn truy c·∫≠p th∆∞ m·ª•c.`);
        }
        const data = await res.json();
        if (!data.files) {
          throw new Error('Kh√¥ng nh·∫≠n ƒë∆∞·ª£c danh s√°ch file t·ª´ Google Drive. Th∆∞ m·ª•c c√≥ th·ªÉ tr·ªëng ho·∫∑c kh√¥ng ƒë∆∞·ª£c chia s·∫ª.');
        }
        // S·∫Øp x·∫øp file theo t√™n (A-Z)
        return data.files.sort((a, b) => a.name.localeCompare(b.name));
      } catch (error) {
        console.error('L·ªói khi t·∫£i d·ªØ li·ªáu:', error);
        const folderList = document.getElementById('folderList');
        folderList.innerHTML = `<li class="error-message">L·ªói: ${error.message}. Vui l√≤ng ki·ªÉm tra API Key, quy·ªÅn truy c·∫≠p th∆∞ m·ª•c, ho·∫∑c k·∫øt n·ªëi m·∫°ng.</li>`;
        return [];
      }
    }

    function createFolderItem(name, folderId) {
      const li = document.createElement('li');
      const link = document.createElement('a');
      link.className = 'folder';
      link.textContent = `üìÇ ${name}`;
      link.href = "#";

      const childrenDiv = document.createElement('div');
      childrenDiv.className = 'children';

      let loaded = false;

      link.onclick = async () => {
        if (childrenDiv.style.display === 'none') {
          childrenDiv.style.display = 'block';
          if (!loaded) {
            childrenDiv.innerHTML = '‚è≥ ƒêang t·∫£i...';
            const items = await fetchFolderContents(folderId);
            childrenDiv.innerHTML = '';

            if (items.length === 0) {
              childrenDiv.innerHTML = '<i>Kh√¥ng c√≥ d·ªØ li·ªáu.</i>';
            } else {
              const subUl = document.createElement('ul');
              items.forEach(item => {
                if (item.mimeType === 'application/vnd.google-apps.folder') {
                  subUl.appendChild(createFolderItem(item.name, item.id));
                } else {
                  const fileLi = document.createElement('li');
                  const a = document.createElement('a');
                  a.textContent = `üìÑ ${item.name}`;
                  a.href = "#";
                  a.className = 'file-link';
                  a.onclick = () => {
                    if (isImageFile(item.name)) {
                      showImageGallery(folderId, item.id);
                    } else {
                      document.getElementById('pdfViewer').style.display = 'block';
                      document.getElementById('pdfFrame').src = getFileViewerURL(item);
                    }
                  };
                  fileLi.appendChild(a);
                  subUl.appendChild(fileLi);
                }
              });
              childrenDiv.appendChild(subUl);
            }

            loaded = true;
          }
        } else {
          childrenDiv.style.display = 'none';
        }
      };

      li.appendChild(link);
      li.appendChild(childrenDiv);
      return li;
    }

    function isImageFile(name) {
      const lowerName = name.toLowerCase();
      return lowerName.endsWith('.jpg') || lowerName.endsWith('.png') || lowerName.endsWith('.jpeg') || lowerName.endsWith('.webp');
    }

    async function showImageGallery(folderId, selectedImageId) {
      try {
        const items = await fetchFolderContents(folderId);
        const imageItems = items.filter(item => isImageFile(item.name));
        const galleryContainer = document.getElementById('galleryContainer');
        galleryContainer.innerHTML = '';

        if (imageItems.length === 0) {
          galleryContainer.innerHTML = '<p class="error-message">Kh√¥ng c√≥ ·∫£nh trong th∆∞ m·ª•c.</p>';
          document.getElementById('imageGallery').style.display = 'block';
          document.getElementById('galleryTitle').textContent = 'Xem ·∫¢nh';
          return;
        }

        imageItems.forEach(item => {
          const imgDiv = document.createElement('div');
          imgDiv.className = 'gallery-item';
          const img = document.createElement('img');
          img.src = `https://drive.google.com/uc?export=view&id=${item.id}`;
          img.alt = item.name;
          img.loading = 'lazy'; // Lazy loading ƒë·ªÉ c·∫£i thi·ªán hi·ªáu su·∫•t
          img.onerror = () => {
            imgDiv.innerHTML = `<p class="error-message">Kh√¥ng th·ªÉ t·∫£i ·∫£nh: ${item.name}. Vui l√≤ng ki·ªÉm tra quy·ªÅn truy c·∫≠p.</p>`;
          };
          imgDiv.appendChild(img);
          galleryContainer.appendChild(imgDiv);
        });

        document.getElementById('imageGallery').style.display = 'block';
        const selectedIndex = imageItems.findIndex(item => item.id === selectedImageId);
        document.getElementById('galleryTitle').textContent = `Xem ·∫¢nh (${selectedIndex + 1}/${imageItems.length})`;

        if (selectedIndex >= 0) {
          const galleryItem = galleryContainer.children[selectedIndex];
          galleryItem.scrollIntoView({ behavior: 'smooth', inline: 'center' });
        }
      } catch (error) {
        console.error('L·ªói khi t·∫£i gallery:', error);
        document.getElementById('galleryContainer').innerHTML = `<p class="error-message">L·ªói khi t·∫£i ·∫£nh: ${error.message}. Vui l√≤ng ki·ªÉm tra k·∫øt n·ªëi ho·∫∑c quy·ªÅn truy c·∫≠p.</p>`;
        document.getElementById('imageGallery').style.display = 'block';
      }
    }

    function getFileViewerURL(file) {
      const fileId = file.id;
      const name = file.name.toLowerCase();

      if (name.endsWith('.pdf')) {
        return `https://drive.google.com/file/d/${fileId}/preview`;
      }

      return `https://drive.google.com/file/d/${fileId}/view`;
    }

    async function init() {
      const folderList = document.getElementById('folderList');
      folderList.innerHTML = 'ƒêang t·∫£i...';

      const folders = await fetchFolderContents(ROOT_FOLDER_ID);
      folderList.innerHTML = '';

      if (folders.length === 0) {
        folderList.innerHTML = '<li class="error-message">Kh√¥ng c√≥ th∆∞ m·ª•c ho·∫∑c file n√†o. Vui l√≤ng ki·ªÉm tra quy·ªÅn truy c·∫≠p ho·∫∑c ID th∆∞ m·ª•c.</li>';
      } else {
        folders.forEach(item => {
          if (item.mimeType === 'application/vnd.google-apps.folder') {
            folderList.appendChild(createFolderItem(item.name, item.id));
          } else {
            const fileLi = document.createElement('li');
            const a = document.createElement('a');
            a.textContent = `üìÑ ${item.name}`;
            a.href = "#";
            a.className = 'file-link';
            a.onclick = () => {
              if (isImageFile(item.name)) {
                showImageGallery(ROOT_FOLDER_ID, item.id);
              } else {
                document.getElementById('pdfViewer').style.display = 'block';
                document.getElementById('pdfFrame').src = getFileViewerURL(item);
              }
            };
            fileLi.appendChild(a);
            folderList.appendChild(fileLi);
          }
        });
      }
    }

    init();
  </script>
</body>
</html>
