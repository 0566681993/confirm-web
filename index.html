// index.html

<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Access Request</title>
</head>
<body>
  <h2>Nhập Email để truy cập</h2>
  <form id="access-form">
    <input type="email" id="email" placeholder="Email" required />
    <button type="submit">Gửi yêu cầu</button>
    <label>
      <input type="checkbox" id="remember"> Nhớ email
    </label>
  </form>
  <script type="module" src="./main.js"></script>
</body>
</html>// main.js import { createClient } from "https://esm.sh/@supabase/supabase-js";

const supabase = createClient( "https://rtxdvcvzkepogytpnvsi.supabase.co", "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJ0eGR2Y3Z6a2Vwb2d5dHBudnNpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTMyNzI1NzksImV4cCI6MjA2ODg0ODU3OX0.SG_q8rnfAA7LAFoYYQyPsUFZPqsh1C13GbkGln4Z3JU" );

const form = document.getElementById("access-form"); const emailInput = document.getElementById("email"); const rememberCheckbox = document.getElementById("remember");

const deviceId = getDeviceId();

form.addEventListener("submit", async (e) => { e.preventDefault(); const email = emailInput.value.trim().toLowerCase(); if (!email) return alert("Vui lòng nhập email");

// Lưu email nếu được chọn nhớ if (rememberCheckbox.checked) { localStorage.setItem("rememberedEmail", email); }

const { data, error } = await supabase.from("User").select("*").eq("Email", email); if (error) return alert("Lỗi kết nối Supabase");

const user = data[0]; if (user && user.Approval === true && user.Devices === deviceId) { window.location.href = "main.html"; } else { await supabase.from("User").upsert({ Email: email, Devices: deviceId, Approval: false }); sendRequestEmail(email, deviceId); alert("Yêu cầu đã được gửi. Vui lòng chờ admin duyệt."); } });

function getDeviceId() { let id = localStorage.getItem("device_id"); if (!id) { id = crypto.randomUUID(); localStorage.setItem("device_id", id); } return id; }

function sendRequestEmail(email, deviceId) { // ⚠️ Tùy chọn: Tích hợp với EmailJS hoặc webhook server tại đây fetch("https://formspree.io/f/your-form-id", { method: "POST", headers: { "Content-Type": "application/json" }, body: JSON.stringify({ email, deviceId }) }); }

// Auto fill nếu email được nhớ const remembered = localStorage.getItem("rememberedEmail"); if (remembered) { emailInput.value = remembered; }
