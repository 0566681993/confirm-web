<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>TRUY·ªÜN D·ªäCH</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 15px;
      margin: 0;
      user-select: none;
      overflow-x: hidden;
    }

    h2 {
      font-size: clamp(20px, 5vw, 24px);
      margin-bottom: 15px;
    }

    ul {
      list-style-type: none;
      padding-left: 10px;
    }

    li {
      margin: 10px 0;
    }

    a.folder {
      font-size: clamp(16px, 4vw, 18px);
      color: #0066cc;
      font-weight: bold;
      cursor: pointer;
      display: block;
      text-decoration: none;
    }

    a.folder:hover {
      color: #ff6600;
    }

    .children {
      margin-left: 15px;
      font-size: clamp(14px, 3.5vw, 16px);
      display: none;
    }

    .file-link {
      text-decoration: none;
      color: green;
      display: block;
    }

    .file-link:hover {
      text-decoration: underline;
    }

    #pdfViewer {
      margin-top: 20px;
      display: none;
    }

    #pdfFrame {
      border: none;
      width: 100%;
      height: calc(100vh - 150px); /* ƒê·∫£m b·∫£o iframe chi·∫øm kh√¥ng gian ph√π h·ª£p */
      max-height: 600px;
    }

    /* Media Queries cho m√†n h√¨nh nh·ªè */
    @media screen and (max-width: 600px) {
      body {
        padding: 10px;
      }

      h2 {
        font-size: clamp(18px, 4.5vw, 20px);
      }

      a.folder {
        font-size: clamp(14px, 3.8vw, 16px);
      }

      .children {
        margin-left: 10px;
        font-size: clamp(12px, 3.2vw, 14px);
      }

      #pdfFrame {
        height: calc(100vh - 120px); /* Gi·∫£m chi·ªÅu cao tr√™n ƒëi·ªán tho·∫°i */
      }
    }
  </style>
</head>
<body>
  <h2>üìÅ Th∆∞ m·ª•c Google Drive</h2>
  <ul id="folderList">ƒêang t·∫£i...</ul>
  <div id="pdfViewer">
    <h3>Xem PDF</h3>
    <iframe id="pdfFrame" sandbox="allow-same-origin allow-scripts"></iframe>
  </div>

  <script>
    const API_KEY = 'AIzaSyB88SNWBpeBPRkg1KdgXc0K5rEOoih0zOM';
    const ROOT_FOLDER_ID = '1mbA2FZ3cN0lPf9eFyV4Pylw54BEL6ymi';

    // V√¥ hi·ªáu h√≥a chu·ªôt ph·∫£i v√† s·ª± ki·ªán c·∫£m ·ª©ng
    document.addEventListener('contextmenu', function(e) {
      e.preventDefault();
    });

    // V√¥ hi·ªáu h√≥a F12, Ctrl+Shift+I, Ctrl+U, v.v.
    document.addEventListener('keydown', function(e) {
      if (e.key === 'F12' || 
          (e.ctrlKey && e.shiftKey && (e.key === 'I' || e.key === 'C' || e.key === 'J')) || 
          (e.ctrlKey && e.key === 'U')) {
        e.preventDefault();
      }
    });

    // V√¥ hi·ªáu h√≥a sao ch√©p v√† k√©o-th·∫£
    document.addEventListener('copy', function(e) {
      e.preventDefault();
    });
    document.addEventListener('dragstart', function(e) {
      e.preventDefault();
    });

    async function fetchFolderContents(folderId) {
      const url = `https://www.googleapis.com/drive/v3/files?q='${folderId}'+in+parents&key=${API_KEY}&fields=files(id,name,mimeType)`;
      const res = await fetch(url);
      const data = await res.json();
      return data.files || [];
    }

    function createFolderItem(name, folderId) {
      const li = document.createElement('li');
      const link = document.createElement('a');
      link.className = 'folder';
      link.textContent = `üìÇ ${name}`;
      link.href = "#";

      const childrenDiv = document.createElement('div');
      childrenDiv.className = 'children';

      let loaded = false;

      link.onclick = async () => {
        if (childrenDiv.style.display === 'none') {
          childrenDiv.style.display = 'block';
          if (!loaded) {
            childrenDiv.innerHTML = '‚è≥ ƒêang t·∫£i...';
            const items = await fetchFolderContents(folderId);
            childrenDiv.innerHTML = '';

            if (items.length === 0) {
              childrenDiv.innerHTML = '<i>Kh√¥ng c√≥ d·ªØ li·ªáu.</i>';
            } else {
              const subUl = document.createElement('ul');
              items.forEach(item => {
                if (item.mimeType === 'application/vnd.google-apps.folder') {
                  subUl.appendChild(createFolderItem(item.name, item.id));
                } else {
                  const fileLi = document.createElement('li');
                  const viewUrl = getFileViewerURL(item);
                  const a = document.createElement('a');
                  a.textContent = `üìÑ ${item.name}`;
                  a.href = "#";
                  a.className = 'file-link';
                  a.onclick = () => {
                    document.getElementById('pdfViewer').style.display = 'block';
                    document.getElementById('pdfFrame').src = viewUrl;
                    window.scrollTo(0, document.getElementById('pdfViewer').offsetTop); // Cu·ªôn ƒë·∫øn PDF
                  };
                  fileLi.appendChild(a);
                  subUl.appendChild(fileLi);
                }
              });
              childrenDiv.appendChild(subUl);
            }

            loaded = true;
          }
        } else {
          childrenDiv.style.display = 'none';
        }
      };

      li.appendChild(link);
      li.appendChild(childrenDiv);
      return li;
    }

    function getFileViewerURL(file) {
      const fileId = file.id;
      const name = file.name.toLowerCase();

      if (name.endsWith('.pdf') || name.endsWith('.jpg') || name.endsWith('.png') || name.endsWith('.jpeg') || name.endsWith('.webp')) {
        return `https://drive.google.com/file/d/${fileId}/preview`;
      }

      return `https://drive.google.com/file/d/${fileId}/view`;
    }

    async function init() {
      const folderList = document.getElementById('folderList');
      folderList.innerHTML = 'ƒêang t·∫£i...';

      const folders = await fetchFolderContents(ROOT_FOLDER_ID);
      folderList.innerHTML = '';

      if (folders.length === 0) {
        folderList.innerHTML = '<li>Kh√¥ng c√≥ th∆∞ m·ª•c n√†o.</li>';
      } else {
        folders.forEach(item => {
          if (item.mimeType === 'application/vnd.google-apps.folder') {
            folderList.appendChild(createFolderItem(item.name, item.id));
          } else {
            const fileLi = document.createElement('li');
            const a = document.createElement('a');
            a.textContent = `üìÑ ${item.name}`;
            a.href = "#";
            a.className = 'file-link';
            a.onclick = () => {
              document.getElementById('pdfViewer').style.display = 'block';
              document.getElementById('pdfFrame').src = getFileViewerURL(item);
              window.scrollTo(0, document.getElementById('pdfViewer').offsetTop); // Cu·ªôn ƒë·∫øn PDF
            };
            fileLi.appendChild(a);
            folderList.appendChild(fileLi);
          }
        });
      }
    }

    init();
  </script>
</body>
</html>
