<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>TRUY·ªÜN D·ªäCH</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 15px;
      margin: 0;
      user-select: none;
      overflow-x: hidden;
    }

    h2 {
      font-size: clamp(20px, 5vw, 24px);
      margin-bottom: 15px;
    }

    ul {
      list-style-type: none;
      padding-left: 10px;
    }

    li {
      margin: 10px 0;
    }

    a.folder {
      font-size: clamp(16px, 4vw, 18px);
      color: #0066cc;
      font-weight: bold;
      cursor: pointer;
      display: block;
      text-decoration: none;
    }

    a.folder:hover {
      color: #ff6600;
    }

    .children {
      margin-left: 15px;
      font-size: clamp(14px, 3.5vw, 16px);
      display: none;
    }

    .file-link {
      text-decoration: none;
      color: green;
      display: block;
    }

    .file-link:hover {
      text-decoration: underline;
    }

    /* File Viewer (cho c·∫£ PDF v√† ·∫£nh) */
    #fileViewer {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: #fff;
      z-index: 1000;
      display: flex;
      flex-direction: column; /* ƒê·∫∑t iframe tr√™n, navigation d∆∞·ªõi */
    }

    #fileFrame {
      border: none;
      width: 100%;
      flex-grow: 1; /* Iframe chi·∫øm to√†n b·ªô kh√¥ng gian c√≤n l·∫°i */
      display: block;
    }

    .navigation {
      display: flex;
      align-items: center;
      justify-content: space-between; /* Kho·∫£ng c√°ch ƒë·ªÅu gi·ªØa c√°c ph·∫ßn t·ª≠ */
      background: transparent; /* N·ªÅn trong su·ªët */
      padding: 5px 10px;
      z-index: 1001; /* ƒê·∫£m b·∫£o navigation ·ªü tr√™n iframe */
    }

    .navigation .image-name {
      color: #333; /* M√†u ch·ªØ t√™n ·∫£nh */
      font-size: clamp(10px, 2.5vw, 12px); /* K√≠ch th∆∞·ªõc ch·ªØ nh·ªè */
      flex: 1; /* Chi·∫øm kh√¥ng gian b√™n tr√°i */
      text-align: left;
    }

    .navigation .nav-buttons {
      display: flex;
      justify-content: center; /* CƒÉn gi·ªØa n√∫t Tr∆∞·ªõc/Ti·∫øp */
      flex: 1;
    }

    .navigation button {
      background: #ff4d4d;
      color: white;
      border: none;
      padding: 5px 10px; /* Thu nh·ªè n√∫t */
      border-radius: 3px;
      cursor: pointer;
      font-size: clamp(12px, 3vw, 14px); /* Thu nh·ªè ch·ªØ */
      margin: 0 10px; /* Kho·∫£ng c√°ch gi·ªØa c√°c n√∫t */
    }

    .navigation button:hover {
      background: #e60000;
    }

    .navigation .close-button {
      flex: 1;
      text-align: right; /* CƒÉn ph·∫£i n√∫t ƒê√≥ng */
    }

    .error-message {
      color: red;
      font-size: clamp(14px, 3.5vw, 16px);
      text-align: center;
      margin: 10px 0;
    }

    /* Media Queries cho m√†n h√¨nh nh·ªè */
    @media screen and (max-width: 600px) {
      body {
        padding: 10px;
      }

      h2 {
        font-size: clamp(18px, 4.5vw, 20px);
      }

      a.folder {
        font-size: clamp(14px, 3.8vw, 16px);
      }

      .children {
        margin-left: 10px;
        font-size: clamp(12px, 3.2vw, 14px);
      }

      .navigation button {
        padding: 4px 8px;
        font-size: clamp(10px, 2.8vw, 12px);
        margin: 0 8px; /* Kho·∫£ng c√°ch nh·ªè h∆°n tr√™n di ƒë·ªông */
      }

      .navigation .image-name {
        font-size: clamp(8px, 2.2vw, 10px); /* Ch·ªØ nh·ªè h∆°n tr√™n di ƒë·ªông */
      }
    }
  </style>
</head>
<body>
  <h2>üìÅ Th∆∞ m·ª•c Google Drive</h2>
  <ul id="folderList">ƒêang t·∫£i...</ul>
  <div id="fileViewer">
    <iframe id="fileFrame" sandbox="allow-same-origin allow-scripts"></iframe>
    <div class="navigation" id="navigationButtons"></div>
  </div>

  <script>
    const API_KEY = 'AIzaSyB88SNWBpeBPRkg1KdgXc0K5rEOoih0zOM';
    const ROOT_FOLDER_ID = '1mbA2FZ3cN0lPf9eFyV4Pylw54BEL6ymi';

    // Bi·∫øn to√†n c·ª•c ƒë·ªÉ l∆∞u danh s√°ch ·∫£nh v√† ch·ªâ s·ªë hi·ªán t·∫°i
    let currentImages = [];
    let currentImageIndex = 0;
    let currentFolderId = '';

    // V√¥ hi·ªáu h√≥a chu·ªôt ph·∫£i v√† s·ª± ki·ªán c·∫£m ·ª©ng
    document.addEventListener('contextmenu', function(e) {
      e.preventDefault();
    });

    // V√¥ hi·ªáu h√≥a F12, Ctrl+Shift+I, Ctrl+U
    document.addEventListener('keydown', function(e) {
      if (e.key === 'F12' || 
          (e.ctrlKey && e.shiftKey && (e.key === 'I' || e.key === 'C' || e.key === 'J')) || 
          (e.ctrlKey && e.key === 'U')) {
        e.preventDefault();
      }
    });

    // V√¥ hi·ªáu h√≥a sao ch√©p v√† k√©o-th·∫£
    document.addEventListener('copy', function(e) {
      e.preventDefault();
    });
    document.addEventListener('dragstart', function(e) {
      e.preventDefault();
    });

    async function fetchFolderContents(folderId) {
      try {
        const url = `https://www.googleapis.com/drive/v3/files?q='${folderId}'+in+parents&key=${API_KEY}&fields=files(id,name,mimeType)`;
        const res = await fetch(url);
        if (!res.ok) {
          throw new Error(`L·ªói API: ${res.status} ${res.statusText}. Ki·ªÉm tra API Key ho·∫∑c quy·ªÅn truy c·∫≠p th∆∞ m·ª•c.`);
        }
        const data = await res.json();
        if (!data.files) {
          throw new Error('Kh√¥ng nh·∫≠n ƒë∆∞·ª£c danh s√°ch file t·ª´ Google Drive. Th∆∞ m·ª•c c√≥ th·ªÉ tr·ªëng ho·∫∑c kh√¥ng ƒë∆∞·ª£c chia s·∫ª.');
        }
        // S·∫Øp x·∫øp file theo t√™n (A-Z)
        return data.files.sort((a, b) => a.name.localeCompare(b.name));
      } catch (error) {
        console.error('L·ªói khi t·∫£i d·ªØ li·ªáu:', error);
        const folderList = document.getElementById('folderList');
        folderList.innerHTML = `<li class="error-message">L·ªói: ${error.message}. Vui l√≤ng ki·ªÉm tra API Key, quy·ªÅn truy c·∫≠p th∆∞ m·ª•c, ho·∫∑c k·∫øt n·ªëi m·∫°ng.</li>`;
        return [];
      }
    }

    function createFolderItem(name, folderId) {
      const li = document.createElement('li');
      const link = document.createElement('a');
      link.className = 'folder';
      link.textContent = `üìÇ ${name}`;
      link.href = "#";

      const childrenDiv = document.createElement('div');
      childrenDiv.className = 'children';

      let loaded = false;

      link.onclick = async () => {
        if (childrenDiv.style.display === 'none') {
          childrenDiv.style.display = 'block';
          if (!loaded) {
            childrenDiv.innerHTML = '‚è≥ ƒêang t·∫£i...';
            const items = await fetchFolderContents(folderId);
            childrenDiv.innerHTML = '';

            if (items.length === 0) {
              childrenDiv.innerHTML = '<i>Kh√¥ng c√≥ d·ªØ li·ªáu.</i>';
            } else {
              const subUl = document.createElement('ul');
              items.forEach(item => {
                if (item.mimeType === 'application/vnd.google-apps.folder') {
                  subUl.appendChild(createFolderItem(item.name, item.id));
                } else {
                  const fileLi = document.createElement('li');
                  const a = document.createElement('a');
                  a.textContent = `üìÑ ${item.name}`;
                  a.href = "#";
                  a.className = 'file-link';
                  a.onclick = () => {
                    if (isImageFile(item.name)) {
                      showImageInViewer(folderId, item.id);
                    } else {
                      document.getElementById('fileViewer').style.display = 'block';
                      document.getElementById('fileFrame').src = getFileViewerURL(item);
                      document.getElementById('navigationButtons').innerHTML = `
                        <div class="close-button">
                          <button onclick="document.getElementById('fileViewer').style.display='none'">X</button>
                        </div>
                      `;
                    }
                  };
                  fileLi.appendChild(a);
                  subUl.appendChild(fileLi);
                }
              });
              childrenDiv.appendChild(subUl);
            }

            loaded = true;
          }
        } else {
          childrenDiv.style.display = 'none';
        }
      };

      li.appendChild(link);
      li.appendChild(childrenDiv);
      return li;
    }

    function isImageFile(name) {
      const lowerName = name.toLowerCase();
      return lowerName.endsWith('.jpg') || lowerName.endsWith('.png') || lowerName.endsWith('.jpeg') || lowerName.endsWith('.webp');
    }

    async function showImageInViewer(folderId, selectedImageId) {
      try {
        currentFolderId = folderId;
        currentImages = (await fetchFolderContents(folderId)).filter(item => isImageFile(item.name));
        
        if (currentImages.length === 0) {
          document.getElementById('fileViewer').style.display = 'block';
          document.getElementById('fileFrame').src = '';
          document.getElementById('navigationButtons').innerHTML = `
            <p class="error-message">Kh√¥ng c√≥ ·∫£nh trong th∆∞ m·ª•c.</p>
            <div class="close-button">
              <button onclick="document.getElementById('fileViewer').style.display='none'">X</button>
            </div>
          `;
          return;
        }

        currentImageIndex = currentImages.findIndex(item => item.id === selectedImageId);
        if (currentImageIndex === -1) {
          currentImageIndex = 0;
        }

        document.getElementById('fileViewer').style.display = 'flex';
        document.getElementById('fileFrame').src = getFileViewerURL(currentImages[currentImageIndex]);
        document.getElementById('navigationButtons').innerHTML = `
          <span class="image-name">${currentImages[currentImageIndex].name}</span>
          <div class="nav-buttons">
            <button ${currentImages.length <= 1 ? 'disabled' : ''} onclick="navigateImage(-1)"><<</button>
            <button ${currentImages.length <= 1 ? 'disabled' : ''} onclick="navigateImage(1)">>></button>
          </div>
          <div class="close-button">
            <button onclick="document.getElementById('fileViewer').style.display='none'">X</button>
          </div>
        `;
      } catch (error) {
        console.error('L·ªói khi t·∫£i ·∫£nh:', error);
        document.getElementById('fileViewer').style.display = 'block';
        document.getElementById('fileFrame').src = '';
        document.getElementById('navigationButtons').innerHTML = `
          <p class="error-message">L·ªói khi t·∫£i ·∫£nh: ${error.message}</p>
          <div class="close-button">
            <button onclick="document.getElementById('fileViewer').style.display='none'">X</button>
          </div>
        `;
      }
    }

    function navigateImage(direction) {
      currentImageIndex += direction;
      if (currentImageIndex < 0) {
        currentImageIndex = currentImages.length - 1;
      } else if (currentImageIndex >= currentImages.length) {
        currentImageIndex = 0;
      }

      document.getElementById('fileFrame').src = getFileViewerURL(currentImages[currentImageIndex]);
      document.getElementById('navigationButtons').innerHTML = `
        <span class="image-name">${currentImages[currentImageIndex].name}</span>
        <div class="nav-buttons">
          <button ${currentImages.length <= 1 ? 'disabled' : ''} onclick="navigateImage(-1)"><<</button>
          <button ${currentImages.length <= 1 ? 'disabled' : ''} onclick="navigateImage(1)">>></button>
        </div>
        <div class="close-button">
          <button onclick="document.getElementById('fileViewer').style.display='none'">X</button>
        </div>
      `;
    }

    function getFileViewerURL(file) {
      const fileId = file.id;
      const name = file.name.toLowerCase();

      if (name.endsWith('.pdf') || name.endsWith('.jpg') || name.endsWith('.png') || name.endsWith('.jpeg') || name.endsWith('.webp')) {
        return `https://drive.google.com/file/d/${fileId}/preview`;
      }

      return `https://drive.google.com/file/d/${fileId}/view`;
    }

    async function init() {
      const folderList = document.getElementById('folderList');
      folderList.innerHTML = 'ƒêang t·∫£i...';

      const folders = await fetchFolderContents(ROOT_FOLDER_ID);
      folderList.innerHTML = '';

      if (folders.length === 0) {
        folderList.innerHTML = '<li class="error-message">Kh√¥ng c√≥ th∆∞ m·ª•c ho·∫∑c file n√†o. Vui l√≤ng ki·ªÉm tra quy·ªÅn truy c·∫≠p ho·∫∑c ID th∆∞ m·ª•c.</li>';
      } else {
        folders.forEach(item => {
          if (item.mimeType === 'application/vnd.google-apps.folder') {
            folderList.appendChild(createFolderItem(item.name, item.id));
          } else {
            const fileLi = document.createElement('li');
            const a = document.createElement('a');
            a.textContent = `üìÑ ${item.name}`;
            a.href = "#";
            a.className = 'file-link';
            a.onclick = () => {
              if (isImageFile(item.name)) {
                showImageInViewer(ROOT_FOLDER_ID, item.id);
              } else {
                document.getElementById('fileViewer').style.display = 'block';
                document.getElementById('fileFrame').src = getFileViewerURL(item);
                document.getElementById('navigationButtons').innerHTML = `
                  <div class="close-button">
                    <button onclick="document.getElementById('fileViewer').style.display='none'">X</button>
                  </div>
                `;
              }
            };
            fileLi.appendChild(a);
            folderList.appendChild(fileLi);
          }
        });
      }
    }

    init();
  </script>
</body>
</html>
