<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title> TRUY·ªÜN D·ªäCH </title>
  <style>
    body { font-family: Arial; padding: 20px; }
    h2 { font-size: 28px; }
    ul { list-style-type: none; padding-left: 20px; }
    li { margin: 8px 0; }
    a.folder { font-size: 20px; color: #0066cc; font-weight: bold; cursor: pointer; }
    a.folder:hover { color: #ff6600; }
    .children { margin-left: 20px; font-size: 16px; display: none; }
    .file-link { text-decoration: none; color: green; }
    .file-link:hover { text-decoration: underline; }
  </style>
</head>
<body>
  <h2>üìÅ Th∆∞ m·ª•c Google Drive</h2>
  <ul id="folderList">ƒêang t·∫£i...</ul>

  <script>
    const API_KEY = 'AIzaSyB88SNWBpeBPRkg1KdgXc0K5rEOoih0zOM';
    const ROOT_FOLDER_ID = '1mbA2FZ3cN0lPf9eFyV4Pylw54BEL6ymi';

    async function fetchFolderContents(folderId) {
      const url = `https://www.googleapis.com/drive/v3/files?q='${folderId}'+in+parents&key=${API_KEY}&fields=files(id,name,mimeType)`;
      const res = await fetch(url);
      const data = await res.json();
      return data.files || [];
    }

    function createFolderItem(name, folderId) {
      const li = document.createElement('li');
      const link = document.createElement('a');
      link.className = 'folder';
      link.textContent = `üìÇ ${name}`;
      link.href = "#";

      const childrenDiv = document.createElement('div');
      childrenDiv.className = 'children';

      let loaded = false;

      link.onclick = async () => {
        if (childrenDiv.style.display === 'none') {
          childrenDiv.style.display = 'block';
          if (!loaded) {
            childrenDiv.innerHTML = '‚è≥ ƒêang t·∫£i...';
            const items = await fetchFolderContents(folderId);
            childrenDiv.innerHTML = '';

            if (items.length === 0) {
              childrenDiv.innerHTML = '<i>Kh√¥ng c√≥ d·ªØ li·ªáu.</i>';
            } else {
              const subUl = document.createElement('ul');
              items.forEach(item => {
                if (item.mimeType === 'application/vnd.google-apps.folder') {
                  subUl.appendChild(createFolderItem(item.name, item.id));
                } else {
                  const fileLi = document.createElement('li');
                  const viewUrl = getFileViewerURL(item);
                  const a = document.createElement('a');
                  a.textContent = `üìÑ ${item.name}`;
                  a.href = viewUrl;
                  a.target = '_blank';
                  a.className = 'file-link';
                  fileLi.appendChild(a);
                  subUl.appendChild(fileLi);
                }
              });
              childrenDiv.appendChild(subUl);
            }

            loaded = true;
          }
        } else {
          childrenDiv.style.display = 'none';
        }
      };

      li.appendChild(link);
      li.appendChild(childrenDiv);
      return li;
    }

    function getFileViewerURL(file) {
      const fileId = file.id;
      const name = file.name.toLowerCase();

      if (name.endsWith('.pdf') || name.endsWith('.jpg') || name.endsWith('.png') || name.endsWith('.jpeg') || name.endsWith('.webp')) {
        return `https://drive.google.com/file/d/${fileId}/preview`;
      }

      return `https://drive.google.com/file/d/${fileId}/view`;
    }

    async function init() {
      const folderList = document.getElementById('folderList');
      folderList.innerHTML = 'ƒêang t·∫£i...';

      const folders = await fetchFolderContents(ROOT_FOLDER_ID);
      folderList.innerHTML = '';

      if (folders.length === 0) {
        folderList.innerHTML = '<li>Kh√¥ng c√≥ th∆∞ m·ª•c n√†o.</li>';
      } else {
        folders.forEach(item => {
          if (item.mimeType === 'application/vnd.google-apps.folder') {
            folderList.appendChild(createFolderItem(item.name, item.id));
          } else {
            const fileLi = document.createElement('li');
            const a = document.createElement('a');
            a.textContent = `üìÑ ${item.name}`;
            a.href = getFileViewerURL(item);
            a.target = '_blank';
            a.className = 'file-link';
            fileLi.appendChild(a);
            folderList.appendChild(fileLi);
          }
        });
      }
    }

    init();
  </script>
</body>
</html>
