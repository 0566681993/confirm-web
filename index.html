<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Tr√¨nh duy·ªát th∆∞ m·ª•c</title>
  <style>
    body { font-family: Arial; margin: 2em; }
    ul { list-style: none; padding-left: 1em; }
    li { margin: 5px 0; cursor: pointer; }
    .folder::before { content: "üìÅ "; }
    .file::before { content: "üìÑ "; }
  </style>
</head>
<body>
  <h2>üìÇ Tr√¨nh duy·ªát th∆∞ m·ª•c</h2>
  <div id="browser"></div>

  <script>
    const api = '/api/list?path=';

    async function loadFolder(path, container) {
      const res = await fetch(api + encodeURIComponent(path));
      const data = await res.json();

      const ul = document.createElement('ul');

      // Th∆∞ m·ª•c con
      for (const folder of data.folders) {
        const li = document.createElement('li');
        li.textContent = folder;
        li.classList.add('folder');
        li.addEventListener('click', () => {
          li.innerHTML += ' ‚è≥';
          loadFolder(path + '/' + folder, li);
          li.removeEventListener('click', arguments.callee);
        });
        ul.appendChild(li);
      }

      // File
      for (const file of data.files) {
        const li = document.createElement('li');
        li.textContent = file;
        li.classList.add('file');
        li.addEventListener('click', () => openFile(path + '/' + file));
        ul.appendChild(li);
      }

      container.appendChild(ul);
    }

    function openFile(fullPath) {
      const ext = fullPath.split('.').pop().toLowerCase();
      if (ext === 'pdf') {
        window.open(`viewer.html?file=${encodeURIComponent(fullPath)}`, '_blank');
      } else if (['jpg', 'jpeg', 'png', 'gif', 'webp'].includes(ext)) {
        window.open(fullPath, '_blank');
      } else {
        alert('Kh√¥ng h·ªó tr·ª£ ƒë·ªãnh d·∫°ng n√†y');
      }
    }

    // Load g·ªëc
    loadFolder('', document.getElementById('browser'));
  </script>
</body>
</html>
